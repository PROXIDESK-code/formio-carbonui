<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width">
    <script id="header" type="text/template">
        <div class="usa-overlay"></div>
        <header class="usa-header usa-header--basic">
            <div class="usa-nav-container">
                <div class="usa-navbar">
                    <div class="usa-logo" id="basic-logo">
                        <em class="usa-logo__text"><span title="Home" aria-label="Home" id="form-title">Form Viewer</span></em>
                    </div>
                </div>
            </div>
        </header>
    </script>
    <script id="branding" type="text/template">
      <hr />
      <h4 class="text-center text-muted">powered by <img src="assets/logo.png" style="height: 1.2em;vertical-align: middle;" /></h4>
      <h5 class="text-center text-muted">Application: <span id="uswds-version"></span></h5>
    </script>
    <script id="srcform" type="text/template">
        <div class="well src-form">
            <div class="form-group">
                <label class="usa-label" for="formsrc">Form Embed URL</label>
                <input class="usa-input" type="text" id="formsrc" name="formsrc" placeholder="https://examples.form.io/example">
            </div>
            <button type="submit" class="usa-button" id="setsrc" style="margin-top: 1em;">Show Form</button>
        </div>
    </script>
    <script id="loader" type="text/template"><div class="loader-wrapper"><div class="loader text-center"></div></div></script>
    <script src="lib/formiojs/formio.form.min.js"></script>
    <script src="lib/seamless/seamless.child.min.js"></script>
    <script type="text/javascript">
      var query = {};
      var parts = [];
      var paths = [];
      var src = '';
      var hashes = location.hash.substr(1).replace(/\?/g, '&').split("&");

      // Search the location search for query parameters.
      location.search.substr(1).split("&").forEach(function(item) {
        parts = item.split('=');
        if (parts.length > 1) {
          query[parts[0]] = parts[1] && decodeURIComponent(parts[1]);
        }
      });

      // Also search hashes.
      hashes.forEach(function (item) {
        var parts = item.split("=");
        if (parts.length > 1) {
          query[parts[0]] = parts[1] && decodeURIComponent(parts[1]);
        }
        else if (item.indexOf('/') === 0) {
          paths = item.substr(1).split('/');
        }
      });

      var protocol = query.protocol || 'https';
      var host = query.host || 'api.form.io';
      var baseUrl = protocol + '://' + host;
      Formio.setBaseUrl(baseUrl);

      if (query.src) {
        src = query.src;
      }

      // If there are paths provided.
      if (paths.length > 1) {
        var projectUrl = query.host ? (baseUrl + '/' + paths[0]) : (protocol + '://' + paths[0] + '.form.io');

        // Set the project url.
        Formio.setProjectUrl(projectUrl);

        // Set the source.
        if (!query.src) {
          src = projectUrl + '/' + paths[1];
          if (paths.length > 3 && paths[2] === 'submission') {
            src += '/submission/' + paths[3];
          }
        }
      }

      // Allow them to provide SSO tokens to the form viewer.
      if (query.token) {
        localStorage.setItem('formioToken', query.token);
        localStorage.removeItem('formioAppUser');
        localStorage.removeItem('formioUser');
      }
    </script>
    <link rel="stylesheet" href="lib/formiojs/formio.form.min.css" />
    <link rel="stylesheet" href="lib/uswds/styles.css" />
    <link rel="stylesheet" href="lib/uswds/uswds.min.css" />
    <link rel="stylesheet" href="lib/fontawesome/font-awesome.css" />
    <style type="text/css">
        .grid-container.main {
            max-width: 96rem;
        }

        .page-break-after {
            page-break-after: always;
        }

        .page-break-before {
            page-break-before: always;
            margin-top: 10px;
        }

        .page-break	{
            display: block;
            page-break-before: always;
            margin-top: 10px;
        }

        .formio-component {
            page-break-inside:avoid;
        }

        .formio-component-form {
            page-break-inside: auto;
        }

        .main {
            margin-top: 10px;
        }

        .iframe.notheme {
            background-color: transparent;
        }
        .iframe .main {
            margin:0;
            padding:0;
            width: 100%;
        }
        .iframe.hasheader .main {
            margin-bottom: 55px;
        }
        .iframe .navbar .container {
            margin:0;
            width: 100%;
        }
        .navbar .container .navbar-right {
            margin-right: 0;
        }

        .navbar {
            margin-bottom: 0px;
        }

        .fa-spin-custom, .glyphicon-spin {
            -webkit-animation: spin 1000ms infinite linear;
            animation: spin 1000ms infinite linear;
        }
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(359deg);
                transform: rotate(359deg);
            }
        }
        @keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(359deg);
                transform: rotate(359deg);
            }
        }

        .usa-checkbox__input:disabled+.usa-checkbox__label::before, .usa-radio__input:disabled+.usa-radio__label::before {
          background-color: white;
        }
        .usa-radio__input:checked+.usa-radio__label::before, .usa-checkbox__input:checked+.usa-checkbox__label::before {
          background-color: #999 !important;
        }
    </style>
</head>
<body>
<script type="text/javascript">
  var bodyClass = '';
  if (!query.hasOwnProperty('header') || parseInt(query.header, 10)) {
    document.write(document.getElementById('header').innerHTML);
    bodyClass += 'hasheader ';
  }
  if (query.iframe && parseInt(query.iframe, 10)) {
    bodyClass += 'iframe ';
    if (!query.theme) {
      bodyClass += 'notheme ';
    }
  }
  if (bodyClass) {
    document.body.className = bodyClass;
  }
</script>
<div class="grid-container main" id="main">
    <div id="preform"></div>
    <div id="formio"></div>
</div>
<script type="text/javascript">
  window.seamless.connect({container: 'div.main', allowStyleInjection: true});
  var mainElem = document.getElementById('main');
  var preFormElem = document.getElementById('preform');
  var loader = document.getElementById('loader');
  var formioElem = document.getElementById("formio");
  var titleElem = document.getElementById("form-title");
  preFormElem.innerHTML = loader.innerHTML;
  var branding = !query.hasOwnProperty('branding') || parseInt(query.branding, 10);
  Formio.license = !branding;

  // You must keep "window.setForm = function(form, submission, options)". This
  // is what the PDF renderer uses to generate a form with predefined form, submission, and options.
  window.setForm = function(form, submission, options) {
    preFormElem.innerHTML = loader.innerHTML;
    options = options || {};
    if (!form) {
      console.warn('No form object provided');
    }

    // If the form is a string, then load it first and then try again.
    if (typeof form === 'string') {
      var formio = new Formio(form);
      formio.loadForm().then(function(formObj) {
        if (!submission && formio.submissionId) {
          formio.loadSubmission().then(function(subObj) {
            formObj.src = form;
            window.setForm(formObj, subObj, options);
          });
        }
        else {
          formObj.src = form;
          window.setForm(formObj, submission, options);
        }
      });
      return;
    }

    options.show = {};
    options.hide = {};

    if (options.pdf) {
      FormioUtils.eachComponent(form.components, function(component) {
      if (component.tags && component.tags.length) {
        if (component.tags.includes('viewer:show')) {
          options.show[component.key] = true;
        }
        if (component.tags.includes('viewer:hide')) {
          options.hide[component.key] = true;
        }
      }
     });
    }

    Formio.icons = 'fontawesome';
    return Formio.createForm(formioElem, form, options)
    .then(function(instance) {
      // Remove the entire preform element.
      mainElem.removeChild(preFormElem);

      // Set the source of the form if it is provided.
      if (form.src) {
        instance.url = form.src;
        instance.nosubmit = false;
      }

      if (titleElem) {
        titleElem.innerHTML = instance.form.title;
      }
      if (!submission) {
        return instance;
      }

      return instance.setSubmission(submission).then(function() {
        instance.redraw();
        return instance.dataReady.then(function() {
          instance.checkData(instance.data, {
            noValidate: true
          });
          return new Promise(function(resolve) {
            // Wait for window to stop rendering
            return window.requestAnimationFrame(resolve);
          });
        });
      });
    });
  };

  if (src) {
    window.setForm(src);
  }
  else {
    preFormElem.innerHTML = document.getElementById('srcform').innerHTML;
    var srcBtn = document.getElementById('setsrc');
    var formSrcElem = document.getElementById('formsrc');
    srcBtn.addEventListener('click', function(event) {
      event.preventDefault();
      if (!formSrcElem.value) {
        alert('You must provide a Form Embed URL');
        return;
      }

      var formSrc = formSrcElem.value;
      if (formSrc && formSrc.split('?')[0].match(/\/download$/)) {
        // This is a pdf form to render.
        var script = document.createElement('script');
        script.setAttribute('src', formSrc + '&format=html');
        document.body.appendChild(script);
      }
      else {
        window.setForm(formSrcElem.value);
      }
    });
  }

  if (branding) {
    document.write(document.getElementById('branding').innerHTML);
    document.getElementById('uswds-version').innerHTML = Formio.USWDS.version;
  }
</script>
<script type="text/javascript">
  // Keep this file as ES5!
  var Formio;
  var renderForm = function(form, submission, options, evalOptions) {
    // Bail with retry if core library isn't loaded yet
    if (!Formio) {
      return setTimeout(function() {
        renderForm(form, submission, options, evalOptions);
      }, 100);
    }

    var readyFlagRaised = false;

    // Copied from https://gist.github.com/kamilogorek/8819542
    var waitForImages = function(_cb) {
      var imagesLoaded = false;
      var cb = function() {
        if (!imagesLoaded) {
          imagesLoaded = true;
          _cb();
        }
      };
      var allImgsLength = 0;
      var allImgsLoaded = 0;
      var allImgs = [];

      // Add a fallback to render the form even without loading all images.
      setTimeout(cb, 3000);

      var filtered = Array.prototype.filter.call(document.querySelectorAll('img'), function (item) {
        if (item.src === '') {
          return false;
        }

        // Firefox's `complete` property will always be `true` even if the image has not been downloaded.
        // Doing it this way works in Firefox.
        var img = new Image();
        img.src = item.src;
        return !img.complete;
      });

      filtered.forEach(function (item) {
        allImgs.push({
          src: item.src,
          element: item
        });
      });

      allImgsLength = allImgs.length;
      allImgsLoaded = 0;

      // If no images found, don't bother.
      if (allImgsLength === 0) {
        cb();
      }

      allImgs.forEach(function (img) {
        var image = new Image();

        // Handle the image loading and error with the same callback.
        image.addEventListener('load', function () {
          allImgsLoaded++;
          if (allImgsLoaded === allImgsLength) {
            cb();
            return false;
          }
        });

        image.src = img.src;
      });
    };

    var raiseReadyFlag = function(force) {
      // Skip if we've already raised the ready flag and aren't forcing a recheck
      if (readyFlagRaised && force !== true) {
        return;
      }

      // Wait for all images to load first.
      waitForImages(function() {
        // Mark the ready flag as raised
        readyFlagRaised = true;

        // If a timezone loading promise exists, wait on that and then force a retry
        if (!FormioUtils.zonesLoaded() && FormioUtils.moment && FormioUtils.moment.zonesPromise) {
          return FormioUtils.moment.zonesPromise.then(function() {
            raiseReadyFlag(true);
          });
        }

        // Set window status to ready after a final buffer interval for good measure
        setTimeout(function() {
          window.status = 'ready';
        }, evalOptions.renderBuffer);
      });
    };

    // Apply evalOptions and set display mode
    Formio.setBaseUrl(evalOptions.baseUrl);
    Formio.setProjectUrl(evalOptions.baseUrl + '/project/' + evalOptions.project);

    if (evalOptions.token) {
      Formio.setToken(evalOptions.token);
    }

    form.display = 'form';

    // Set the form
    window.setForm(form, submission, options).then(raiseReadyFlag)
      .catch(err => {
        console.log(err);
        raiseReadyFlag();
      });

    // Still generate after 5 seconds if our setForm promise fails to resolve
    setTimeout(raiseReadyFlag, evalOptions.timeout || 5000);
  };

  renderForm(
    {"_id":"5f04c16a66d07500bcfee613","type":"form","tags":[],"deleted":null,"owner":"5ed180f3d360a23ae50b00e8","components":[{"label":"Text Field","tableView":true,"key":"textField","type":"textfield","input":true},{"label":"One","tableView":false,"key":"one","type":"checkbox","input":true,"defaultValue":false},{"label":"Two","tableView":false,"key":"two","type":"checkbox","input":true,"defaultValue":false},{"label":"Radio","optionsLabelPosition":"right","inline":false,"tableView":false,"values":[{"label":"One","value":"one","shortcut":""},{"label":"Two","value":"two","shortcut":""},{"label":"Three","value":"three","shortcut":""}],"key":"radio","type":"radio","input":true},{"label":"Select Boxes","optionsLabelPosition":"right","tableView":false,"values":[{"label":"One","value":"one","shortcut":""},{"label":"Two","value":"two","shortcut":""},{"label":"Three","value":"three","shortcut":""}],"key":"selectBoxes","type":"selectboxes","input":true,"inputType":"checkbox","defaultValue":{"":false}},{"type":"button","label":"Submit","key":"submit","disableOnInvalid":true,"input":true,"tableView":false}],"revisions":"","_vid":0,"title":"WQERQWER","display":"form","access":[{"roles":["5ed1811ad360a23ae50b00fa","5ed1811ad360a23ae50b00fb","5ed1811ad360a23ae50b00fc","5eda92bf002c15abfcd89742"],"type":"read_all"}],"submissionAccess":[],"controller":"","properties":{},"settings":{},"name":"wqerqwer","path":"wqerqwer","project":"5ed1811ad360a23ae50b00f9","created":"2020-07-07T18:39:38.240Z","modified":"2020-07-09T18:14:29.014Z","machineName":"sandbox:wqerqwer","__v":2},
    {"_id":"5f075e8bb868310aa9f16bdb","owner":"5ed180f3d360a23ae50b00e8","deleted":null,"roles":[],"_vid":0,"_fvid":0,"state":"submitted","data":{"textField":"","one":false,"two":true,"radio":"two","selectBoxes":{"one":true,"two":false,"three":true},"submit":true},"access":[],"metadata":{"timezone":"America/Chicago","offset":-300,"origin":"http://localhost:3001","referrer":"","browserName":"Netscape","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36","pathName":"/","onLine":true},"form":"5f04c16a66d07500bcfee613","project":"5ed1811ad360a23ae50b00f9","externalIds":[],"externalTokens":[],"created":"2020-07-09T18:14:35.720Z","modified":"2020-07-09T18:14:35.720Z","__v":0},
    {"pdf":true,"readOnly":true,"uploadOnly":true,"defaultOpen":true,"hideButtons":true,"pageOptions":{"format":"A4","scale":1,"width":"800px","height":"1100px","printBackground":true,"margin":{"top":"0px","right":"0px","bottom":"0px","left":"0px"}}},
    {"baseUrl":"http://formio-server:3000","project":"5ed1811ad360a23ae50b00f9","timeout":5000,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb3JtIjp7Il9pZCI6IjVlZDE4MGYzZDM2MGEyM2FlNTBiMDBkYSIsInByb2plY3QiOiI1ZWQxODBmMmQzNjBhMjNhZTUwYjAwZDYifSwidXNlciI6eyJfaWQiOiI1ZWQxODBmM2QzNjBhMjNhZTUwYjAwZTgifSwicHJvamVjdCI6eyJfaWQiOiI1ZWQxODBmMmQzNjBhMjNhZTUwYjAwZDYifSwiaWF0IjoxNTk0MzE4NTA0LCJleHAiOjE1OTQzMzI5MDR9.ZJTrQDyLT0p0zHnlpEI4Qu97ZWF2Q1avWEhxuVBHMtI","renderBuffer":100}
  );
</script>
</body>
</html>
